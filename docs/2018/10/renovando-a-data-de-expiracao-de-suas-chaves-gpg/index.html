<!DOCTYPE html>
<html lang="pt-br" class="wf-firasans-n4-active wf-active">
	<head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Enable responsiveness on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    
    <meta name="generator" content="Hugo 0.51" />
    
    <title>Renovando a data de expiração de suas chaves GPG &middot; </title>
    <meta content="Renovando a data de expiração de suas chaves GPG - " property="og:title">
    <meta content=" - " property="og:description">
    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i|Roboto+Mono:300,300i,400,400i" rel="stylesheet">
    <link rel="stylesheet" href="https://daltonmatos.com/css/print.css" media="print">
    <link rel="stylesheet" href="https://daltonmatos.com/css/poole.css">
    <link rel="stylesheet" href="https://daltonmatos.com/css/hyde.css">
    <link rel="stylesheet" href="https://daltonmatos.com/css/syntax.css">
    <!-- Font-Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/all.js" integrity="sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe" crossorigin="anonymous"></script>
    
    <!-- Customised CSS -->
    <link rel="stylesheet" href="https://daltonmatos.com/css/custom.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

	</head>
    <body class="theme-base-08 ">
        <div class="sidebar">
  <div class="container text-center ">
    <div class="sidebar-about text-center">
      <a href="https://daltonmatos.com/"><h1 class="brand"></h1></a>
       <img src="/daltonmatos.jpeg" alt="Author Image" class="img-circle headshot center"> 
      <p class="lead">
         Dalton Barreto 
      </p>
    </div>
    
<div>
	<ul class="sidebar-nav">
		
		
				<li>
					<a href="/"> <span>Home</span></a>
				</li>
				<li>
					<a href="/gpg/"> <span>GPG Public Key</span></a>
				</li>
				<li>
					<a href="/about/"> <span>About</span></a>
				</li>
		</li>
	</ul>
</div>

    <p>
      <section class="row text-center">
	
	<a href="https://twitter.com/daltonmatos"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	&nbsp;<a href="https://github.com/daltonmatos"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
</section>

    </p>
    <p class="copyright">&copy; 2018 Dalton Barreto.
      <a href="https://creativecommons.org/licenses/by/4.0">Some Rights Reserved</a>.<br/>Built with <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
    </p>
  </div>
  <div>
  </div>
</div>

        <div class="content container">
            <div class="post">
  <h1>Renovando a data de expiração de suas chaves GPG</h1>
  
  <div class="col-sm-12 col-md-12">
    <span class="text-left post-date meta">
            
       
        <i class="fas fa-calendar-alt"></i> Oct 23, 2018
      
      
      
      
        
        
            <br/>
             <i class="fas fa-tags"></i>
            
            <a class="meta" href="/tags/crypt">crypt</a> 
        
            <a class="meta" href="/tags/gnupg">gnupg</a> 
        
            <a class="meta" href="/tags/gpg">gpg</a> 
        
            <a class="meta" href="/tags/pass">pass</a>
        
      
      
      <br/>
      <i class="fas fa-clock"></i> 6 min read 
      </span>  
  </div>    
  
  

<p>Escolhi uma data de expiração de 6 meses para minhas chaves GPG. Penso nisso como uma forma de &ldquo;prova de vida&rdquo;, onde a comprovação que eu ainda
mantenho o controle da chave privada é o fato de eu poder renovar a data de expiração de cada uma das chaves GPG.</p>

<p>Eis que chegou hora de fazer a primeira renovação (desde que adotei essa ideia de expirar as chaves de tempos em tempos). Aqui vamos ver o passo a passo de como podemos fazer essa renovação. E como isso afeta as <a href="/2018/08/usando-seu-keyring-gpg-para-guardar-sua-chave-ssh/">chaves que estão no smarcartd</a>.</p>

<h1 id="usando-o-gnupg-em-uma-pasta-não-padrão">Usando o GnuPG em uma pasta não padrão</h1>

<p>Para trocar as datas você precisa estar de posse da chave privada, para isso restaure o backup das suas chaves em um pasta qualquer e aponte o <code>gnupg</code> pra lá.</p>

<pre><code>$ pwd                                            
/home/daltonmatos/.gpg
$ export GNUPGHOME=./gnupg
$ gpg -K           
/home/daltonmatos/.gpg/./gnupg/pubring.kbx
------------------------------------------
sec   rsa4096/389D4E1EC7F29FEF 2017-02-04 [SC]
      26A166B648B4863E96176558389D4E1EC7F29FEF
      Keygrip = 128DFDE36E82F2403A8CCBFC7A008DFC33A396E4
uid                 [ultimate] Dalton Barreto &lt;daltonmatos@gmail.com&gt;
uid                 [ultimate] Dalton Barreto &lt;dalton.matos@sieve.com.br&gt;
uid                 [ultimate] Dalton Barreto &lt;dalton.matos@b2wdigital.com&gt;
ssb   rsa4096/3B147A3234E02C43 2017-02-04 [S]
      Keygrip = 1A064CBF467D9EC6BE7C5D082A5E0514E3C9E432
ssb&gt;  rsa4096/05570C19E57F6BB4 2017-05-16 [S] [expires: 2018-10-30]
      Keygrip = 0C2183A16531119C0BC5272089C435783E9BE339
ssb&gt;  rsa4096/45768D9D6F14D474 2017-09-14 [E] [expires: 2018-10-30]
      Keygrip = 74CF1AF6F457AB8FF459B1FAD69EFAD2610A94A0
ssb&gt;  rsa4096/AB8F87FDAD12AD6E 2017-09-14 [A]
      Keygrip = B12ECF12A5BCD345013AFBB459BF262E9F40B5C8
</code></pre>

<p>Aqui vemos que estou usando a pasta <code>/home/daltonmatos/.gpg/./gnupg/</code> como sendo meu keyring. Ali dentro está o backup das minhas chaves privadas.</p>

<p>Agora que confirmamos que o <code>GnuPG</code> está olhando para o lugar correto, podemos editar as chaves.</p>

<h1 id="trocando-as-datas">Trocando as datas</h1>

<p>Aqui vamos usar a edição normal de chaves:</p>

<pre><code>$gpg --edit-key daltonmatos@gmail.com
gpg (GnuPG) 2.2.10; Copyright (C) 2018 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Secret key is available.

sec  rsa4096/389D4E1EC7F29FEF
     created: 2017-02-04  expires: never       usage: SC  
     trust: ultimate      validity: ultimate
ssb  rsa4096/3B147A3234E02C43
     created: 2017-02-04  expires: never       usage: S   
ssb  rsa4096/05570C19E57F6BB4
     created: 2017-05-16  expires: 2018-10-30  usage: S   
     card-no: 0006 06250168
ssb  rsa4096/45768D9D6F14D474
     created: 2017-09-14  expires: 2018-10-30  usage: E   
     card-no: 0006 06250168
ssb  rsa4096/AB8F87FDAD12AD6E
     created: 2017-09-14  expires: never       usage: A   
     card-no: 0006 06250168
[ultimate] (1). Dalton Barreto &lt;daltonmatos@gmail.com&gt;
[ultimate] (2)  Dalton Barreto &lt;dalton.matos@sieve.com.br&gt;
[ultimate] (3)  Dalton Barreto &lt;dalton.matos@b2wdigital.com&gt;
</code></pre>

<p>Percebam que as chaves <code>rsa4096/05570C19E57F6BB4</code> e <code>rsa4096/45768D9D6F14D474</code> possuem data de expiração.</p>

<p>Agora selecionamos quais chaves queremos mexer, fazemos isso com o comando <code>key</code>.</p>

<pre><code>gpg&gt; key 2
gpg&gt; key 3
gpg&gt; list

sec  rsa4096/389D4E1EC7F29FEF
     created: 2017-02-04  expires: never       usage: SC  
     trust: ultimate      validity: ultimate
ssb  rsa4096/3B147A3234E02C43
     created: 2017-02-04  expires: never       usage: S   
ssb* rsa4096/05570C19E57F6BB4
     created: 2017-05-16  expires: 2019-01-16  usage: S   
     card-no: 0006 06250168
ssb* rsa4096/45768D9D6F14D474
     created: 2017-09-14  expires: 2019-01-16  usage: E   
     card-no: 0006 06250168
ssb  rsa4096/AB8F87FDAD12AD6E
     created: 2017-09-14  expires: never       usage: A   
     card-no: 0006 06250168
[ultimate] (1). Dalton Barreto &lt;daltonmatos@gmail.com&gt;
[ultimate] (2)  Dalton Barreto &lt;dalton.matos@sieve.com.br&gt;
[ultimate] (3)  Dalton Barreto &lt;dalton.matos@b2wdigital.com&gt;
</code></pre>

<p>Agora que as duas chaves corretas estão selecionadas, usamos o comando <code>expire</code>:</p>

<pre><code>gpg&gt; expire
Are you sure you want to change the expiration time for multiple subkeys? (y/N) y
Please specify how long the key should be valid.
         0 = key does not expire
      &lt;n&gt;  = key expires in n days
      &lt;n&gt;w = key expires in n weeks
      &lt;n&gt;m = key expires in n months
      &lt;n&gt;y = key expires in n years
Key is valid for? (0) 
</code></pre>

<p>E aqui você escolhe o novo período de expiraçao das suas chaves. Depois disso apenas digite <code>save</code> e saia do <code>GnuPG</code>.</p>

<h1 id="importando-a-nova-chave-pública">Importando a nova chave pública</h1>

<p>Agora que temos as chaves modificadas, precisamos re-exportar nossa chave pública e re distrirbuí-la. Para isso rode:</p>

<pre><code>$ gpg --export daltonmatos@gmail.com
</code></pre>

<p>Isso vai gerar uma nova cópia da sua chave púbica, com as datas atualizadas.</p>

<h1 id="impacto-nas-chaves-que-estão-dentro-do-smartcard">Impacto nas chaves que estão dentro do smartcard</h1>

<p>No meu caso tenho minhas chaves privadas dentro de um smarcartd. Nesse momento ele está indicando que as chaves estão perto de expirar, mostrando a data <code>2018-10-30</code>.</p>

<pre><code>$ gpg --card-status

Reader ...........: &lt;redacted&gt;
Application ID ...: &lt;redacted&gt;
Version ..........: 2.1
Manufacturer .....: Yubico
Serial number ....: &lt;redacted&gt;
Name of cardholder: Dalton Barreto
Language prefs ...: br
Sex ..............: male
URL of public key : https://daltonmatos.com/daltonmatos.pub
Login data .......: daltonmatos
Signature PIN ....: not forced
Key attributes ...: rsa4096 rsa4096 rsa4096
Max. PIN lengths .: 127 127 127
PIN retry counter : 3 0 3
Signature counter : 5167
Signature key ....: CD07 76B0 E29F 585E BD3F  5E92 0557 0C19 E57F 6BB4
      created ....: 2017-05-16 23:21:41
Encryption key....: 7360 120F DE66 3A8A 165A  0039 4576 8D9D 6F14 D474
      created ....: 2017-09-14 13:16:21
Authentication key: 6561 5742 10EF 27DA 42B3  4AC9 AB8F 87FD AD12 AD6E
      created ....: 2017-09-14 13:21:06
General key info..: sub  rsa4096/05570C19E57F6BB4 2017-05-16 Dalton Barreto &lt;daltonmatos@gmail.com&gt;
sec#  rsa4096/389D4E1EC7F29FEF  created: 2017-02-04  expires: never     
ssb#  rsa4096/3B147A3234E02C43  created: 2017-02-04  expires: never     
ssb&gt;  rsa4096/05570C19E57F6BB4  created: 2017-05-16  expires: 2018-10-30
                                card-no: 0006 06250168
ssb&gt;  rsa4096/45768D9D6F14D474  created: 2017-09-14  expires: 2018-10-30
                                card-no: 0006 06250168
ssb&gt;  rsa4096/AB8F87FDAD12AD6E  created: 2017-09-14  expires: never     
                                card-no: 0006 06250168

</code></pre>

<p>Mas basta eu importar minha chave recém criada (com as datas atualizadas):</p>

<pre><code>$ gpg --import ~/src/daltonmatos.com/static/daltonmatos.pub 
gpg: key 389D4E1EC7F29FEF: public key &quot;Dalton Barreto &lt;daltonmatos@gmail.com&gt;&quot; imported
gpg: Total number processed: 1
gpg:               imported: 1
</code></pre>

<p>E a partir de agora, o <code>GnuPG</code> já mostra as datas novas no status do smartcard:</p>

<pre><code>$ gpg --card-status                                        

Reader ...........: &lt;redacted&gt;
Application ID ...: &lt;redacted&gt;
Version ..........: 2.1
Manufacturer .....: Yubico
Serial number ....: &lt;redacted&gt;
Name of cardholder: Dalton Barreto
Language prefs ...: br
Sex ..............: male
URL of public key : https://daltonmatos.com/daltonmatos.pub
Login data .......: daltonmatos
Signature PIN ....: not forced
Key attributes ...: rsa4096 rsa4096 rsa4096
Max. PIN lengths .: 127 127 127
PIN retry counter : 3 0 3
Signature counter : 5167
Signature key ....: CD07 76B0 E29F 585E BD3F  5E92 0557 0C19 E57F 6BB4
      created ....: 2017-05-16 23:21:41
Encryption key....: 7360 120F DE66 3A8A 165A  0039 4576 8D9D 6F14 D474
      created ....: 2017-09-14 13:16:21
Authentication key: 6561 5742 10EF 27DA 42B3  4AC9 AB8F 87FD AD12 AD6E
      created ....: 2017-09-14 13:21:06
General key info..: sub  rsa4096/05570C19E57F6BB4 2017-05-16 Dalton Barreto &lt;daltonmatos@gmail.com&gt;
sec#  rsa4096/389D4E1EC7F29FEF  created: 2017-02-04  expires: never     
ssb#  rsa4096/3B147A3234E02C43  created: 2017-02-04  expires: never     
ssb&gt;  rsa4096/05570C19E57F6BB4  created: 2017-05-16  expires: 2019-01-16
                                card-no: 0006 06250168
ssb&gt;  rsa4096/45768D9D6F14D474  created: 2017-09-14  expires: 2019-01-16
                                card-no: 0006 06250168
ssb&gt;  rsa4096/AB8F87FDAD12AD6E  created: 2017-09-14  expires: never     
                                card-no: 0006 06250168
</code></pre>

<p>Uma outra forma de fazer, no meu caso, seria atualizar minha chave no meu site e fazer:</p>

<pre><code>$ gpg --card-edit  


gpg/card&gt; fetch
gpg: requesting key from 'https://daltonmatos.com/daltonmatos.pub'
gpg: key 389D4E1EC7F29FEF: &quot;Dalton Barreto &lt;daltonmatos@gmail.com&gt;&quot; imported
gpg: Total number processed: 1
gpg:              unchanged: 1
</code></pre>

<p>E a partir de agora as chaves estão com nova data de expiração.</p>

</div>
            <div class="footer">
                

    

            </div>
        </div>
        
        
    </body>
</html>
